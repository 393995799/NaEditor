{"remainingRequest":"D:\\Project\\NaEditor\\node_modules\\awesome-typescript-loader\\dist\\entry.js!D:\\Project\\NaEditor\\node_modules\\thread-loader\\dist\\cjs.js!D:\\Project\\NaEditor\\src\\component\\Hotspot\\HotspotModal.tsx","dependencies":[{"path":"D:\\Project\\NaEditor\\src\\component\\Hotspot\\HotspotModal.tsx","mtime":1535223759208},{"path":"D:\\Project\\NaEditor\\src\\component\\Hotspot\\HotspotModal.tsx","mtime":1535223759208},{"path":"D:\\Project\\NaEditor\\src\\component\\Hotspot\\Area.tsx","mtime":1533698584000},{"path":"D:\\Project\\NaEditor\\src\\component\\interface.tsx","mtime":1535210015291},{"path":"D:\\Project\\NaEditor\\src\\component\\CarouselConfig\\interface.ts","mtime":1533698584000},{"path":"D:\\Project\\NaEditor\\src\\component\\ImageHotspotConfig\\interface.tsx","mtime":1533698584000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\version\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\upload\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\upload\\Dragger.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\upload\\interface.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\@types\\react\\index.d.ts","mtime":1532389452000},{"path":"D:\\Project\\NaEditor\\node_modules\\@types\\react\\global.d.ts","mtime":1532389452000},{"path":"D:\\Project\\NaEditor\\node_modules\\csstype\\index.d.ts","mtime":1532213362000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\upload\\Upload.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\upload\\utils.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\mention\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\tooltip\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\tooltip\\placements.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\timeline\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\timeline\\TimelineItem.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\timeline\\Timeline.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\time-picker\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\moment\\moment.d.ts","mtime":1527836312000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\tag\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\tag\\CheckableTag.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\tabs\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\tree-select\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\select\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\tree-select\\interface.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\tree\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\tree\\DirectoryTree.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\tree\\Tree.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\transfer\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\transfer\\search.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\transfer\\operation.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\transfer\\list.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\table\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\table\\interface.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\pagination\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\pagination\\Pagination.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\checkbox\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\checkbox\\Group.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\checkbox\\Checkbox.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\radio\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\radio\\interface.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\radio\\radioButton.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\radio\\group.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\radio\\radio.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\table\\createStore.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\spin\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\table\\Table.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\table\\ColumnGroup.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\table\\Column.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\switch\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\steps\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\slider\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\row\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\grid\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\grid\\col.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\grid\\row.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\rate\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\progress\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\progress\\progress.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\popover\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\popconfirm\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\button\\button.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\button\\button-group.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\notification\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\modal\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\modal\\ActionButton.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\modal\\Modal.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\menu\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\layout\\Sider.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\menu\\MenuItem.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\menu\\SubMenu.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\message\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\locale-provider\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\modal\\locale.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\list\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\list\\Item.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\layout\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\layout\\layout.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\input-number\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\_util\\type.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\input\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\input\\TextArea.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\input\\Search.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\input\\Input.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\input\\Group.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\icon\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\form\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\form\\FormItem.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\form\\Form.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\drawer\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\dropdown\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\dropdown\\dropdown-button.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\dropdown\\dropdown.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\divider\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\date-picker\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\date-picker\\interface.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\col\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\cascader\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\carousel\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\collapse\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\collapse\\CollapsePanel.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\collapse\\Collapse.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\card\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\card\\Meta.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\card\\Grid.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\calendar\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\calendar\\Header.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\button\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\breadcrumb\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\breadcrumb\\BreadcrumbItem.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\breadcrumb\\Breadcrumb.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\badge\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\badge\\ScrollNumber.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\back-top\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\avatar\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\alert\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\auto-complete\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\anchor\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\anchor\\AnchorLink.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\anchor\\Anchor.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\affix\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\src\\component\\Hotspot\\HotspotLink.tsx","mtime":1533698584000},{"path":"D:\\Project\\NaEditor\\src\\OuterComponent.d.ts","mtime":1535074092000},{"path":"D:\\Project\\NaEditor\\node_modules\\cache-loader\\dist\\cjs.js","mtime":0},{"path":"D:\\Project\\NaEditor\\node_modules\\awesome-typescript-loader\\dist\\entry.js","mtime":1529596564000},{"path":"D:\\Project\\NaEditor\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000}],"contextDependencies":[],"result":["import React from 'react';\r\nimport { Modal, message } from 'antd';\r\n/// <reference path=\"../OuterComponent.d.ts\" />\r\nimport addEventListener from 'rc-util/lib/Dom/addEventListener';\r\nimport HotspotLink from './HotspotLink';\r\nimport Area from './Area';\r\nclass HotspotModal extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.imgContainer = React.createRef();\r\n        this.handleStartDraw = (e) => {\r\n            const { areas: currentAreas } = this.state;\r\n            let areas = currentAreas.slice(0);\r\n            const target = e.target;\r\n            const { offsetTop, offsetLeft } = target;\r\n            let { nativeEvent: { offsetX, offsetY, }, } = e;\r\n            offsetX += offsetLeft;\r\n            offsetY += offsetTop;\r\n            areas.push({\r\n                x: offsetX,\r\n                y: offsetY,\r\n                w: 0,\r\n                h: 0,\r\n            });\r\n            this.setState({\r\n                areas,\r\n                currentAreaIndex: areas.length - 1,\r\n            });\r\n        };\r\n        this.handleEndDraw = () => {\r\n            const { hotspots: currentHotspots, areas, } = this.state;\r\n            const hotspots = areas.map((v, i) => {\r\n                let result;\r\n                if (currentHotspots[i]) {\r\n                    result = currentHotspots[i];\r\n                    result.area = v;\r\n                }\r\n                else { // 新热区\r\n                    if (this.isAreaLegal(v)) {\r\n                        result = {\r\n                            area: v,\r\n                            url: '',\r\n                        };\r\n                    }\r\n                    else {\r\n                        result = null;\r\n                    }\r\n                }\r\n                return result;\r\n            }).filter(v => v);\r\n            this.setState({\r\n                currentAreaIndex: -1,\r\n                hotspots,\r\n                areas: this.hotspotsToAreas(hotspots),\r\n            });\r\n        };\r\n        this.handleDrag = (e) => {\r\n            const { currentAreaIndex, areas: currentAreas, } = this.state;\r\n            if (currentAreaIndex === -1) {\r\n                return;\r\n            } // 鼠标没有按下\r\n            const target = e.target;\r\n            // if (target.tagName.toLocaleLowerCase() !== 'img' && !target.className.includes('d-area')) { return; }\r\n            const { offsetTop, offsetLeft } = target;\r\n            let { nativeEvent: { offsetX, offsetY, }, } = e;\r\n            offsetX += offsetLeft;\r\n            offsetY += offsetTop;\r\n            let area = currentAreas[currentAreaIndex];\r\n            let { x: originX, y: originY, } = area;\r\n            originX = originX || 0;\r\n            originY = originY || 0;\r\n            this.hotSpotChange(currentAreaIndex, Object.assign({}, area, {\r\n                w: offsetX - originX,\r\n                h: offsetY - originY,\r\n            }));\r\n        };\r\n        /**\r\n         * 热区变更处理\r\n         * @param index 热区序号\r\n         * @param area 热区参数变更信息\r\n         */\r\n        this.hotSpotChange = (index, area) => {\r\n            const { areas: currentAreas, } = this.state;\r\n            const areas = currentAreas.slice(0);\r\n            areas[index] = area;\r\n            this.setState({\r\n                areas,\r\n            });\r\n        };\r\n        this.hotspotsToAreas = (hotspots) => {\r\n            return hotspots.map(v => v.area || {});\r\n        };\r\n        this.renderImgs = (imgs) => {\r\n            const renderImg = (v, i) => {\r\n                return (React.createElement(\"img\", { key: i, src: v.url, draggable: false, onMouseDown: this.handleStartDraw, onDragStart: (e) => { e.stopPropagation(); } }));\r\n            };\r\n            return (React.createElement(React.Fragment, null, imgs.map(renderImg)));\r\n        };\r\n        this.linkChange = (index, url) => {\r\n            const { hotspots: currentHotspots } = this.state;\r\n            let hotspots;\r\n            if (currentHotspots !== undefined && index < currentHotspots.length) {\r\n                hotspots = currentHotspots.map((v, i) => {\r\n                    if (index === i) {\r\n                        v.url = url;\r\n                    }\r\n                    return v;\r\n                });\r\n            }\r\n            else { // 新增项\r\n                hotspots = (currentHotspots || []).concat([{ url }]);\r\n            }\r\n            this.setState({\r\n                hotspots,\r\n            });\r\n        };\r\n        this.linkRemove = (index) => {\r\n            const { hotspots: currentHotspots } = this.state;\r\n            const hotspots = currentHotspots.filter((v, i) => i !== index);\r\n            this.setState({\r\n                hotspots,\r\n                areas: this.hotspotsToAreas(hotspots),\r\n            });\r\n        };\r\n        this.linkUp = (index) => {\r\n            this.moveLink(index - 1, index);\r\n        };\r\n        this.linkDown = (index) => {\r\n            this.moveLink(index + 1, index);\r\n        };\r\n        this.moveLink = (preIndex, curIndex) => {\r\n            let hotspots;\r\n            let temp = this.props.imgs.slice(0); // 深拷贝\r\n            let target = temp.splice(curIndex, 1);\r\n            // 移到最前面\r\n            if (preIndex < 0) {\r\n                hotspots = target.concat(temp);\r\n            }\r\n            else {\r\n                temp.splice(preIndex, 0, target[0]);\r\n                hotspots = temp;\r\n            }\r\n            this.setState({\r\n                hotspots,\r\n            });\r\n        };\r\n        this.renderHotspots = (hotspots) => {\r\n            const renderItem = (v, i) => {\r\n                return (React.createElement(HotspotLink, { key: i, index: i, value: v.url, onChange: (value) => { this.linkChange(i, value); }, onRemove: () => { this.linkRemove(i); } }));\r\n            };\r\n            return (React.createElement(React.Fragment, null, hotspots.map(renderItem)));\r\n        };\r\n        this.renderAreas = (areas) => {\r\n            const renderArea = (v, i) => {\r\n                let { x = 0, y = 0, w = 0, h = 0, } = v;\r\n                return (React.createElement(Area, { key: i, index: i, onRemove: this.linkRemove, onChange: this.hotSpotChange, x: x, y: y, w: w, h: h }));\r\n            };\r\n            return (React.createElement(React.Fragment, null, areas.map(renderArea)));\r\n        };\r\n        this.isHotspotsLegal = (hotspots) => {\r\n            const result = hotspots.reduce((acc, v, i) => {\r\n                if (acc !== undefined) {\r\n                    return acc;\r\n                }\r\n                if (v.url === '') {\r\n                    return i;\r\n                }\r\n            }, undefined);\r\n            if (result === undefined) {\r\n                return true;\r\n            }\r\n            else {\r\n                message.error(`您还没有配置热区${result + 1}的链接`);\r\n                return false;\r\n            }\r\n        };\r\n        this.numberToPercent = (hotspots) => {\r\n            return hotspots.map(({ area = {}, url }) => {\r\n                const result = {\r\n                    url,\r\n                    area: {\r\n                        x: transform(area.x || 0),\r\n                        y: transform(area.y || 0),\r\n                        w: transform(area.w || 0),\r\n                        h: transform(area.h || 0),\r\n                    }\r\n                };\r\n                return result;\r\n            });\r\n            function transform(px) {\r\n                return Number.parseFloat((px / 750).toFixed(3));\r\n            }\r\n        };\r\n        this.handleOk = () => {\r\n            const { hotspots } = this.state;\r\n            if (this.isHotspotsLegal(hotspots)) {\r\n                // const result = this.numberToPercent(hotspots)\r\n                this.props.onOk(hotspots);\r\n            }\r\n        };\r\n        this.handleCancel = () => {\r\n            this.props.onCancel();\r\n        };\r\n        let { hotspots } = this.props;\r\n        if (!hotspots) {\r\n            hotspots = [];\r\n        }\r\n        // const {\r\n        //     offsetLeft: offsetX,\r\n        //     offsetTop: offsetY,\r\n        // } = this.imgContainer;\r\n        this.state = {\r\n            hotspots,\r\n            areas: this.hotspotsToAreas(hotspots),\r\n            currentAreaIndex: -1,\r\n        };\r\n        this.dragEvent = addEventListener(document, 'mousemove', this.handleDrag);\r\n        this.dropEvent = addEventListener(document, 'mouseup', this.handleEndDraw);\r\n    }\r\n    componentWillUnmount() {\r\n        this.dragEvent.remove();\r\n        this.dropEvent.remove();\r\n    }\r\n    isAreaLegal(area) {\r\n        const { x, y, w, h } = area;\r\n        if (w === undefined || w < 50 || h === undefined || h < 50) {\r\n            message.error('热区大小必须大于50*50px');\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n    render() {\r\n        let { isModalVisible: visible, imgs, } = this.props;\r\n        const { areas, hotspots } = this.state;\r\n        return (React.createElement(Modal, { className: \"d-hotspot-modal\", visible: visible, title: React.createElement(\"span\", { className: \"d-title\" }, \"\\u56FE\\u7247\\u70ED\\u533A\"), width: \"70%\", onOk: this.handleOk, onCancel: this.handleCancel },\r\n            React.createElement(\"div\", { className: \"d-content\" },\r\n                React.createElement(\"div\", { className: \"d-imgs-container\", draggable: false },\r\n                    React.createElement(\"div\", { className: \"d-imgs-wrap\", draggable: false, ref: this.imgContainer },\r\n                        this.renderImgs(imgs),\r\n                        this.renderAreas(areas))),\r\n                React.createElement(\"div\", { className: \"d-hotspots-container\" }, this.renderHotspots(hotspots)))));\r\n    }\r\n}\r\nexport default HotspotModal;\r\n",{"version":3,"file":"D:/Project/NaEditor/src/component/Hotspot/HotspotModal.tsx","sourceRoot":"D:/Project/NaEditor/","sources":["node_modules\\thread-loader\\dist\\cjs.js!D:\\Project\\NaEditor\\src\\component\\Hotspot\\HotspotModal.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { MouseEventHandler, RefObject } from 'react';\nimport { Modal, message } from 'antd';\n/// <reference path=\"../OuterComponent.d.ts\" />\nimport addEventListener from 'rc-util/lib/Dom/addEventListener';\n\nimport { ImageInfo, HotspotInfo, AreaInfo } from '../interface';\nimport HotspotLink from './HotspotLink';\nimport Area from './Area';\n\ninterface HotspotModalProps {\n    imgs: ImageInfo[];\n    hotspots?: HotspotInfo[];\n    isModalVisible: boolean;\n    onCancel: () => void;\n    onOk: (hotspots: HotspotInfo[]) => void;\n}\n\ninterface HotspotModalState {\n    hotspots: HotspotInfo[];\n    areas: AreaInfo[];\n    currentAreaIndex: number;\n    // containerOffsetX: number;\n    // containerOffsetY: number;\n}\n\nclass HotspotModal extends React.Component<HotspotModalProps, HotspotModalState> {\n\n    dragEvent: any;\n    dropEvent: any;\n    private imgContainer: RefObject<HTMLDivElement> = React.createRef();\n\n    constructor(props: HotspotModalProps) {\n        super(props);\n        let { hotspots } = this.props;\n        if (!hotspots) {\n            hotspots = [];\n        }\n        // const {\n        //     offsetLeft: offsetX,\n        //     offsetTop: offsetY,\n        // } = this.imgContainer;\n        this.state = {\n            hotspots,\n            areas: this.hotspotsToAreas(hotspots),\n            currentAreaIndex: -1,    // -1表示当前没有被拖动的热区\n\n        };\n        this.dragEvent = addEventListener(document, 'mousemove', this.handleDrag);\n        this.dropEvent = addEventListener(document, 'mouseup', this.handleEndDraw);\n    }\n\n    componentWillUnmount() {\n        this.dragEvent.remove();\n        this.dropEvent.remove();\n    }\n\n    handleStartDraw = (e: React.MouseEvent) => {\n        const { areas: currentAreas } = this.state;\n        let areas = currentAreas.slice(0);\n        const target: HTMLElement = e.target as HTMLElement;\n        const { offsetTop, offsetLeft } = target;\n        let {\n            nativeEvent: {\n                offsetX,\n                offsetY,\n            },\n        } = e;\n        offsetX += offsetLeft;\n        offsetY += offsetTop;\n        areas.push({\n            x: offsetX,\n            y: offsetY,\n            w: 0,\n            h: 0,\n        });\n        this.setState({\n            areas,\n            currentAreaIndex: areas.length - 1,\n        });\n    }\n\n    handleEndDraw = () => {\n        const {\n            hotspots: currentHotspots,\n            areas,\n        } = this.state;\n        const hotspots: HotspotInfo[] = areas.map((v, i) => {\n            let result: any;\n            if (currentHotspots[i]) {\n                result = currentHotspots[i];\n                result.area = v;\n            } else {  // 新热区\n                if (this.isAreaLegal(v)) {\n                    result = {\n                        area: v,\n                        url: '',\n                    };\n                } else {\n                    result = null;\n                }\n            }\n            return result;\n        }).filter(v => v);\n        this.setState({\n            currentAreaIndex: -1,\n            hotspots,\n            areas: this.hotspotsToAreas(hotspots),\n        });\n    }\n\n    handleDrag = (e: React.MouseEvent) => {\n        const {\n            currentAreaIndex,\n            areas: currentAreas,\n        } = this.state;\n\n        if (currentAreaIndex === -1) { return; }    // 鼠标没有按下\n        const target: HTMLElement = e.target as HTMLElement;\n        // if (target.tagName.toLocaleLowerCase() !== 'img' && !target.className.includes('d-area')) { return; }\n        const { offsetTop, offsetLeft } = target;\n        let {\n            nativeEvent: {\n                offsetX,\n                offsetY,\n            },\n        } = e;\n        offsetX += offsetLeft;\n        offsetY += offsetTop;\n        let area = currentAreas[currentAreaIndex];\n        let {\n            x: originX,\n            y: originY,\n        } = area;\n        originX = originX || 0;\n        originY = originY || 0;\n        this.hotSpotChange(currentAreaIndex, Object.assign({}, area, {\n            w: offsetX - originX,\n            h: offsetY - originY,\n        }));\n    }\n\n    /**\n     * 热区变更处理\n     * @param index 热区序号\n     * @param area 热区参数变更信息\n     */\n    hotSpotChange = (index: number, area: AreaInfo) => {\n        const {\n            areas: currentAreas,\n        } = this.state;\n        const areas = currentAreas.slice(0);\n        areas[index] = area;\n        this.setState({\n            areas,\n        });\n    }\n\n    hotspotsToAreas = (hotspots: HotspotInfo[]): AreaInfo[] => {\n        return hotspots.map(v => v.area || {});\n    }\n\n    renderImgs = (imgs: ImageInfo[]) => {\n\n        const renderImg = (v: ImageInfo, i: number) => {\n            return (\n                <img\n                    key={i}\n                    src={v.url}\n                    draggable={false}\n                    onMouseDown={this.handleStartDraw}\n                    onDragStart={(e) => { e.stopPropagation(); }}\n                />\n            );\n        };\n        return (\n            <React.Fragment>\n                {imgs.map(renderImg)}\n            </React.Fragment>\n        );\n    }\n\n    linkChange = (index: number, url: string) => {\n        const { hotspots: currentHotspots } = this.state;\n        let hotspots;\n        if (currentHotspots !== undefined && index < currentHotspots.length) {\n            hotspots = currentHotspots.map((v, i) => {\n                if (index === i) {\n                    v.url = url;\n                }\n                return v;\n            });\n        } else {// 新增项\n            hotspots = (currentHotspots || []).concat([{ url }]);\n        }\n        this.setState({\n            hotspots,\n        });\n    }\n\n    linkRemove = (index: number) => {\n        const { hotspots: currentHotspots } = this.state;\n        const hotspots = currentHotspots.filter((v, i) => i !== index);\n        this.setState({\n            hotspots,\n            areas: this.hotspotsToAreas(hotspots),\n        });\n    }\n\n    linkUp = (index: number) => {\n        this.moveLink(index - 1, index);\n    }\n\n    linkDown = (index: number) => {\n        this.moveLink(index + 1, index);\n    }\n\n    moveLink = (preIndex: number, curIndex: number) => {\n        let hotspots: HotspotInfo[];\n        let temp: HotspotInfo[] = this.props.imgs.slice(0);    // 深拷贝\n        let target: HotspotInfo[] = temp.splice(curIndex, 1);\n        // 移到最前面\n        if (preIndex < 0) {\n            hotspots = target.concat(temp);\n        } else {\n            temp.splice(preIndex, 0, target[0]);\n            hotspots = temp;\n        }\n        this.setState({\n            hotspots,\n        });\n    }\n\n    isAreaLegal(area: AreaInfo) {\n        const { x, y, w, h } = area;\n        if (w === undefined || w < 50 || h === undefined || h < 50) {\n            message.error('热区大小必须大于50*50px');\n            return false;\n        }\n        return true;\n    }\n\n    renderHotspots = (hotspots: HotspotInfo[]) => {\n\n        const renderItem = (v: HotspotInfo, i: number) => {\n            return (\n                <HotspotLink\n                    key={i}\n                    index={i}\n                    value={v.url}\n                    onChange={(value) => { this.linkChange(i, value); }}\n                    onRemove={() => { this.linkRemove(i); }}\n                />\n            );\n        };\n\n        return (\n            <React.Fragment>\n                {hotspots.map(renderItem)}\n            </React.Fragment>\n        );\n    }\n\n    renderAreas = (areas: AreaInfo[]) => {\n\n        const renderArea = (v: AreaInfo, i: number) => {\n            let {\n                x = 0, y = 0, w = 0, h = 0,\n            } = v;\n            return (\n                <Area\n                    key={i}\n                    index={i}\n                    onRemove={this.linkRemove}\n                    onChange={this.hotSpotChange}\n                    x={x}\n                    y={y}\n                    w={w}\n                    h={h}\n                />\n            );\n        };\n\n        return (\n            <React.Fragment>\n                {areas.map(renderArea)}\n            </React.Fragment>\n        );\n    }\n\n    isHotspotsLegal = (hotspots: HotspotInfo[]): boolean => {\n        const result = hotspots.reduce((acc: any, v, i) => {\n            if (acc !== undefined) {\n                return acc;\n            }\n            if (v.url === '') {\n                return i;\n            }\n        }, undefined);\n        if (result === undefined) {\n            return true;\n        } else {\n            message.error(`您还没有配置热区${result + 1}的链接`);\n            return false;\n        }\n    }\n\n    numberToPercent = (hotspots: HotspotInfo[]) => {\n        return hotspots.map(({ area = {}, url }) => {\n            const result = {\n                url,\n                area: {\n                    x: transform(area.x || 0),\n                    y: transform(area.y || 0),\n                    w: transform(area.w || 0),\n                    h: transform(area.h || 0),\n                }\n            };\n            return result;\n        });\n\n        function transform(px: number) {\n            return Number.parseFloat((px / 750).toFixed(3));\n        }\n    }\n\n    handleOk = () => {\n        const { hotspots } = this.state;\n        if (this.isHotspotsLegal(hotspots)) {\n            // const result = this.numberToPercent(hotspots)\n            this.props.onOk(hotspots);\n        }\n    }\n\n    handleCancel = () => {\n        this.props.onCancel();\n    }\n\n    render() {\n        let {\n            isModalVisible: visible,\n            imgs,\n        } = this.props;\n        const { areas, hotspots } = this.state;\n        return (\n            <Modal\n                className=\"d-hotspot-modal\"\n                visible={visible}\n                title={<span className=\"d-title\">图片热区</span>}\n                width=\"70%\"\n                onOk={this.handleOk}\n                onCancel={this.handleCancel}\n            >\n                <div className=\"d-content\">\n                    <div\n                        className=\"d-imgs-container\"\n                        draggable={false}\n                    >\n                        <div\n                            className=\"d-imgs-wrap\"\n                            draggable={false}\n                            ref={this.imgContainer}\n                        >\n                            {this.renderImgs(imgs)}\n                            {this.renderAreas(areas)}\n                        </div>\n                    </div>\n                    <div className=\"d-hotspots-container\">\n                        {this.renderHotspots(hotspots)}\n                    </div>\n                </div>\n            </Modal>\n        );\n    }\n}\n\nexport default HotspotModal;"]}]}