{"remainingRequest":"D:\\Project\\NaEditor\\node_modules\\awesome-typescript-loader\\dist\\entry.js!D:\\Project\\NaEditor\\node_modules\\thread-loader\\dist\\cjs.js!D:\\Project\\NaEditor\\src\\component\\Module\\Module.tsx","dependencies":[{"path":"D:\\Project\\NaEditor\\src\\component\\Module\\Module.tsx","mtime":1535212345519},{"path":"D:\\Project\\NaEditor\\src\\component\\Module\\Module.tsx","mtime":1535212345519},{"path":"D:\\Project\\NaEditor\\src\\component\\interface.tsx","mtime":1535210015291},{"path":"D:\\Project\\NaEditor\\src\\component\\CarouselConfig\\interface.ts","mtime":1533698584000},{"path":"D:\\Project\\NaEditor\\src\\component\\ImageHotspotConfig\\interface.tsx","mtime":1533698584000},{"path":"D:\\Project\\NaEditor\\src\\component\\ModuleWrap\\index.ts","mtime":1533698584000},{"path":"D:\\Project\\NaEditor\\src\\component\\ModuleWrap\\ModuleWrap.tsx","mtime":1535215091369},{"path":"D:\\Project\\NaEditor\\src\\actions\\index.js","mtime":1535090122000},{"path":"D:\\Project\\NaEditor\\src\\common\\script\\action.ts","mtime":1535214522899},{"path":"D:\\Project\\NaEditor\\node_modules\\axios\\index.d.ts","mtime":1519077740000},{"path":"D:\\Project\\NaEditor\\src\\common\\script\\INTERFACE.ts","mtime":1535204665672},{"path":"D:\\Project\\NaEditor\\src\\db\\dbConfig.js","mtime":1533698584000},{"path":"D:\\Project\\NaEditor\\node_modules\\idb\\lib\\idb.d.ts","mtime":1520276302000},{"path":"D:\\Project\\NaEditor\\node_modules\\localforage\\typings\\localforage.d.ts","mtime":1529170699000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\version\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\upload\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\upload\\Dragger.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\upload\\interface.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\@types\\react\\index.d.ts","mtime":1532389452000},{"path":"D:\\Project\\NaEditor\\node_modules\\@types\\react\\global.d.ts","mtime":1532389452000},{"path":"D:\\Project\\NaEditor\\node_modules\\csstype\\index.d.ts","mtime":1532213362000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\upload\\Upload.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\upload\\utils.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\mention\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\tooltip\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\tooltip\\placements.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\timeline\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\timeline\\TimelineItem.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\timeline\\Timeline.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\time-picker\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\moment\\moment.d.ts","mtime":1527836312000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\tag\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\tag\\CheckableTag.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\tabs\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\tree-select\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\select\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\tree-select\\interface.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\tree\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\tree\\DirectoryTree.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\tree\\Tree.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\transfer\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\transfer\\search.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\transfer\\operation.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\transfer\\list.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\table\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\table\\interface.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\pagination\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\pagination\\Pagination.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\checkbox\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\checkbox\\Group.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\checkbox\\Checkbox.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\radio\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\radio\\interface.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\radio\\radioButton.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\radio\\group.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\radio\\radio.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\table\\createStore.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\spin\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\table\\Table.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\table\\ColumnGroup.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\table\\Column.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\switch\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\steps\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\slider\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\row\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\grid\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\grid\\col.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\grid\\row.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\rate\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\progress\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\progress\\progress.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\popover\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\popconfirm\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\button\\button.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\button\\button-group.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\notification\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\modal\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\modal\\ActionButton.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\modal\\Modal.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\menu\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\layout\\Sider.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\menu\\MenuItem.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\menu\\SubMenu.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\message\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\locale-provider\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\modal\\locale.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\list\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\list\\Item.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\layout\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\layout\\layout.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\input-number\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\_util\\type.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\input\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\input\\TextArea.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\input\\Search.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\input\\Input.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\input\\Group.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\icon\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\form\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\form\\FormItem.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\form\\Form.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\drawer\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\dropdown\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\dropdown\\dropdown-button.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\dropdown\\dropdown.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\divider\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\date-picker\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\date-picker\\interface.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\col\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\cascader\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\carousel\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\collapse\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\collapse\\CollapsePanel.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\collapse\\Collapse.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\card\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\card\\Meta.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\card\\Grid.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\calendar\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\calendar\\Header.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\button\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\breadcrumb\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\breadcrumb\\BreadcrumbItem.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\breadcrumb\\Breadcrumb.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\badge\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\badge\\ScrollNumber.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\back-top\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\avatar\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\alert\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\auto-complete\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\anchor\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\anchor\\AnchorLink.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\anchor\\Anchor.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\antd\\lib\\affix\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\@types\\prop-types\\index.d.ts","mtime":1533863514000},{"path":"D:\\Project\\NaEditor\\node_modules\\@types\\react-redux\\index.d.ts","mtime":1532389452000},{"path":"D:\\Project\\NaEditor\\node_modules\\@types\\react-redux\\node_modules\\redux\\index.d.ts","mtime":499162500000},{"path":"D:\\Project\\NaEditor\\node_modules\\@types\\jquery\\index.d.ts","mtime":1532138750000},{"path":"D:\\Project\\NaEditor\\node_modules\\@types\\lodash\\index.d.ts","mtime":1533259582000},{"path":"D:\\Project\\NaEditor\\node_modules\\@types\\lodash\\common\\util.d.ts","mtime":1533259582000},{"path":"D:\\Project\\NaEditor\\node_modules\\@types\\lodash\\common\\string.d.ts","mtime":1533259582000},{"path":"D:\\Project\\NaEditor\\node_modules\\@types\\lodash\\common\\seq.d.ts","mtime":1533259582000},{"path":"D:\\Project\\NaEditor\\node_modules\\@types\\lodash\\common\\object.d.ts","mtime":1533259582000},{"path":"D:\\Project\\NaEditor\\node_modules\\@types\\lodash\\common\\number.d.ts","mtime":1533259582000},{"path":"D:\\Project\\NaEditor\\node_modules\\@types\\lodash\\common\\math.d.ts","mtime":1533259582000},{"path":"D:\\Project\\NaEditor\\node_modules\\@types\\lodash\\common\\lang.d.ts","mtime":1533259582000},{"path":"D:\\Project\\NaEditor\\node_modules\\@types\\lodash\\common\\function.d.ts","mtime":1533259582000},{"path":"D:\\Project\\NaEditor\\node_modules\\@types\\lodash\\common\\date.d.ts","mtime":1533259582000},{"path":"D:\\Project\\NaEditor\\node_modules\\@types\\lodash\\common\\collection.d.ts","mtime":1533259582000},{"path":"D:\\Project\\NaEditor\\node_modules\\@types\\lodash\\common\\array.d.ts","mtime":1533259582000},{"path":"D:\\Project\\NaEditor\\node_modules\\@types\\lodash\\common\\common.d.ts","mtime":1533259582000},{"path":"D:\\Project\\NaEditor\\node_modules\\cache-loader\\dist\\cjs.js","mtime":0},{"path":"D:\\Project\\NaEditor\\node_modules\\awesome-typescript-loader\\dist\\entry.js","mtime":1529596564000},{"path":"D:\\Project\\NaEditor\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000}],"contextDependencies":[],"result":["import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport PropTypes from 'prop-types';\r\nimport { moduleTopChange, moduleHeightChange } from '../../actions';\r\nimport ModuleWrap from '../ModuleWrap';\r\nclass Module extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.moduleRef = React.createRef();\r\n        const { moduleData } = props;\r\n        if (moduleData.tempData === undefined) {\r\n            moduleData.tempData = {\r\n                isActive: false,\r\n                top: 0,\r\n                height: 0,\r\n            };\r\n        }\r\n        this.state = {\r\n            moduleData: props.moduleData,\r\n        };\r\n    }\r\n    componentWillReceiveProps(nextProps) {\r\n        const { moduleData } = nextProps;\r\n        this.setState({\r\n            moduleData,\r\n        });\r\n        // 模块聚焦后需要滚动到视窗内\r\n        if (moduleData.tempData.isActive === true) {\r\n            this.scrollIntoView();\r\n        }\r\n    }\r\n    componentDidMount() {\r\n        this.reatChange();\r\n        setTimeout(() => {\r\n            this.reatChange();\r\n        }, 1000);\r\n    }\r\n    componentDidUpdate() {\r\n        this.reatChange();\r\n    }\r\n    reatChange() {\r\n        const { moduleTopChange, moduleHeightChange } = this.props;\r\n        const { moduleData } = this.state;\r\n        const clientRect = this.moduleRef.getBoundingClientRect();\r\n        const { height, top } = clientRect;\r\n        if (!moduleData.tempData || top !== moduleData.tempData.top) {\r\n            moduleTopChange(moduleData.moduleId, top);\r\n            if (moduleData.tempData.isActive === true) {\r\n                this.scrollIntoView();\r\n            }\r\n        }\r\n        if (!moduleData.tempData || height !== moduleData.tempData.height) {\r\n            moduleHeightChange(moduleData.moduleId, height);\r\n        }\r\n    }\r\n    scrollIntoView() {\r\n        _.debounce(() => {\r\n            const clientRect = this.moduleRef.getBoundingClientRect();\r\n            const { top } = clientRect;\r\n            const container = document.querySelector('.J_editorInstanceArea');\r\n            // 判断是否在当前屏幕内\r\n            const intersectionObserver = new IntersectionObserver((entries) => {\r\n                const ratio = entries[0].intersectionRatio;\r\n                if (ratio < 1 && container) {\r\n                    // jq动画，待优化\r\n                    $(container).animate({\r\n                        scrollTop: top - 50,\r\n                    }, {\r\n                        easing: 'swing',\r\n                    });\r\n                }\r\n                intersectionObserver.unobserve(this.moduleRef);\r\n            });\r\n            intersectionObserver.observe(this.moduleRef);\r\n        }, 0)();\r\n    }\r\n    render() {\r\n        const { moduleData, moduleData: { tempData: { isActive, }, moduleTypeId, } } = this.state;\r\n        const isDecorate = this.context.BASE_DATA.pageType === 0;\r\n        return (React.createElement(\"div\", { className: `J_module d-module ${isActive ? 'active' : ''}`, \"data-module-type-id\": moduleTypeId, ref: ref => this.moduleRef = ref },\r\n            this.state.isEmpty ? React.createElement(\"div\", { className: \"d-placeholder\" }, \"\\u8BF7\\u914D\\u7F6E\\u6A21\\u5757\\u6570\\u636E\") : this.props.children,\r\n            isDecorate && React.createElement(ModuleWrap, { moduleData: moduleData, moduleRef: this.moduleRef })));\r\n    }\r\n}\r\nModule.contextTypes = {\r\n    BASE_DATA: PropTypes.object\r\n};\r\nconst mapStateToProps = (state) => {\r\n    return { module: state.module }; // TODO dispatch临时丢在这里\r\n};\r\nconst dispatchProps = {\r\n    moduleTopChange,\r\n    moduleHeightChange,\r\n};\r\nconst mergeProps = (stateProps, dispatchProps, ownProps) => {\r\n    return Object.assign({}, stateProps, dispatchProps, ownProps);\r\n};\r\nexport default connect(mapStateToProps, dispatchProps, mergeProps, { withRef: true })(Module);\r\n",{"version":3,"file":"D:/Project/NaEditor/src/component/Module/Module.tsx","sourceRoot":"D:/Project/NaEditor/","sources":["node_modules\\thread-loader\\dist\\cjs.js!D:\\Project\\NaEditor\\src\\component\\Module\\Module.tsx"],"names":[],"mappings":"AAAA,OAAO,KAAoB,MAAM,OAAO,CAAC;AACzC,OAAO,EAAE,OAAO,EAAE,MAAM,aAAa,CAAC;AACtC,OAAO,CAAC,MAAM,QAAQ,CAAC;AACvB,OAAO,CAAC,MAAM,QAAQ,CAAC;AACvB,OAAO,SAAS,MAAM,YAAY,CAAC;AAEnC,OAAO,EAAE,eAAe,EAAE,kBAAkB,EAAE,MAAM,eAAe,CAAC;AACpE,OAAO,UAAU,MAAM,eAAe,CAAC;AAcvC,YAAa,SAAQ,KAAK,CAAC,SAAmC;IAS1D,YAAY,KAAkB;QAC1B,KAAK,CAAC,KAAK,CAAC,CAAC;QART,cAAS,GAAQ,KAAK,CAAC,SAAS,EAAE,CAAC;QASvC,MAAM,EAAE,UAAU,EAAE,GAAG,KAAK,CAAC;QAC7B,IAAI,UAAU,CAAC,QAAQ,KAAK,SAAS,EAAE;YACnC,UAAU,CAAC,QAAQ,GAAG;gBAClB,QAAQ,EAAE,KAAK;gBACf,GAAG,EAAE,CAAC;gBACN,MAAM,EAAE,CAAC;aACZ,CAAA;SACJ;QACD,IAAI,CAAC,KAAK,GAAG;YACT,UAAU,EAAE,KAAK,CAAC,UAAU;SAC/B,CAAC;IACN,CAAC;IAED,yBAAyB,CAAC,SAAsB;QAC5C,MAAM,EAAE,UAAU,EAAE,GAAG,SAAS,CAAC;QACjC,IAAI,CAAC,QAAQ,CAAC;YACV,UAAU;SACb,CAAC,CAAC;QACH,gBAAgB;QAChB,IAAI,UAAU,CAAC,QAAQ,CAAC,QAAQ,KAAK,IAAI,EAAE;YACvC,IAAI,CAAC,cAAc,EAAE,CAAC;SACzB;IACL,CAAC;IAED,iBAAiB;QACb,IAAI,CAAC,UAAU,EAAE,CAAC;QAClB,UAAU,CAAC,GAAG,EAAE;YACZ,IAAI,CAAC,UAAU,EAAE,CAAC;QACtB,CAAC,EAAE,IAAI,CAAC,CAAC;IACb,CAAC;IAED,kBAAkB;QACd,IAAI,CAAC,UAAU,EAAE,CAAC;IACtB,CAAC;IAED,UAAU;QACN,MAAM,EAAE,eAAe,EAAE,kBAAkB,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC;QAC3D,MAAM,EAAE,UAAU,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC;QAClC,MAAM,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC,qBAAqB,EAAE,CAAC;QAC1D,MAAM,EAAE,MAAM,EAAE,GAAG,EAAE,GAAG,UAAU,CAAC;QACnC,IAAI,CAAC,UAAU,CAAC,QAAQ,IAAI,GAAG,KAAK,UAAU,CAAC,QAAQ,CAAC,GAAG,EAAE;YACzD,eAAe,CAAC,UAAU,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAC;YAC1C,IAAI,UAAU,CAAC,QAAQ,CAAC,QAAQ,KAAK,IAAI,EAAE;gBACvC,IAAI,CAAC,cAAc,EAAE,CAAC;aACzB;SACJ;QACD,IAAI,CAAC,UAAU,CAAC,QAAQ,IAAI,MAAM,KAAK,UAAU,CAAC,QAAQ,CAAC,MAAM,EAAE;YAC/D,kBAAkB,CAAC,UAAU,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;SACnD;IACL,CAAC;IAED,cAAc;QACV,CAAC,CAAC,QAAQ,CAAC,GAAG,EAAE;YACZ,MAAM,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC,qBAAqB,EAAE,CAAC;YAC1D,MAAM,EAAE,GAAG,EAAE,GAAG,UAAU,CAAC;YAC3B,MAAM,SAAS,GAAG,QAAQ,CAAC,aAAa,CAAC,uBAAuB,CAAC,CAAC;YAElE,aAAa;YACb,MAAM,oBAAoB,GAAG,IAAI,oBAAoB,CAAC,CAAC,OAAO,EAAE,EAAE;gBAC9D,MAAM,KAAK,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,iBAAiB,CAAC;gBAC3C,IAAI,KAAK,GAAG,CAAC,IAAI,SAAS,EAAE;oBACxB,WAAW;oBACX,CAAC,CAAC,SAAS,CAAC,CAAC,OAAO,CAChB;wBACI,SAAS,EAAE,GAAG,GAAG,EAAE;qBACtB,EAAE;wBACC,MAAM,EAAE,OAAO;qBAClB,CACJ,CAAC;iBACL;gBACD,oBAAoB,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAEnD,CAAC,CAAC,CAAC;YACH,oBAAoB,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACjD,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC;IACZ,CAAC;IAED,MAAM;QACF,MAAM,EACF,UAAU,EACV,UAAU,EAAE,EACR,QAAQ,EAAE,EACN,QAAQ,GACX,EACD,YAAY,GACf,EACJ,GAAG,IAAI,CAAC,KAAK,CAAC;QACf,MAAM,UAAU,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,QAAQ,KAAK,CAAC,CAAC;QAEzD,OAAO,CACH,6BACI,SAAS,EAAE,qBAAqB,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,EAAE,yBACrC,YAAY,EACjC,GAAG,EAAE,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,GAAG,GAAG;YAE/B,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,6BAAK,SAAS,EAAC,eAAe,iDAAc,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ;YACvF,UAAU,IAAI,oBAAC,UAAU,IACtB,UAAU,EAAE,UAAU,EACtB,SAAS,EAAE,IAAI,CAAC,SAAS,GAC3B,CACA,CACT,CAAC;IACN,CAAC;;AA7GM,mBAAY,GAAG;IAClB,SAAS,EAAE,SAAS,CAAC,MAAM;CAC9B,CAAA;AA8GL,MAAM,eAAe,GAAG,CAAC,KAAa,EAAE,EAAE;IACtC,OAAO,EAAE,MAAM,EAAE,KAAK,CAAC,MAAM,EAAE,CAAC,CAAG,sBAAsB;AAC7D,CAAC,CAAC;AAEF,MAAM,aAAa,GAAG;IAClB,eAAe;IACf,kBAAkB;CACrB,CAAC;AAEF,MAAM,UAAU,GAAQ,CAAC,UAAe,EAAE,aAAkB,EAAE,QAAa,EAAE,EAAE;IAC3E,OAAO,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,UAAU,EAAE,aAAa,EAAE,QAAQ,CAAC,CAAC;AAClE,CAAC,CAAC;AAEF,eAAe,OAAO,CAAC,eAAe,EAAE,aAAa,EAAE,UAAU,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC","sourcesContent":["import React, { RefObject } from 'react';\nimport { connect } from 'react-redux';\nimport _ from 'lodash';\nimport $ from 'jquery';\nimport PropTypes from 'prop-types';\n\nimport { moduleTopChange, moduleHeightChange } from '../../actions';\nimport ModuleWrap from '../ModuleWrap';\nimport { IModuleData, IState } from '../interface';\n\ninterface ModuleProps {\n    moduleData: IModuleData;\n    moduleTopChange: any;\n    moduleHeightChange: any;\n}\n\ninterface ModuleState {\n    moduleData: IModuleData;\n    isEmpty?: boolean;\n}\n\nclass Module extends React.Component<ModuleProps, ModuleState> {\n\n    private moduleRef: any = React.createRef();\n\n    static contextTypes = {\n        BASE_DATA: PropTypes.object\n    }\n\n\n    constructor(props: ModuleProps) {\n        super(props);\n        const { moduleData } = props;\n        if (moduleData.tempData === undefined) {\n            moduleData.tempData = {\n                isActive: false,\n                top: 0,\n                height: 0,\n            }\n        }\n        this.state = {\n            moduleData: props.moduleData,\n        };\n    }\n\n    componentWillReceiveProps(nextProps: ModuleProps) {\n        const { moduleData } = nextProps;\n        this.setState({\n            moduleData,\n        });\n        // 模块聚焦后需要滚动到视窗内\n        if (moduleData.tempData.isActive === true) {\n            this.scrollIntoView();\n        }\n    }\n\n    componentDidMount() {\n        this.reatChange();\n        setTimeout(() => {\n            this.reatChange();\n        }, 1000);\n    }\n\n    componentDidUpdate() {\n        this.reatChange();\n    }\n\n    reatChange() {\n        const { moduleTopChange, moduleHeightChange } = this.props;\n        const { moduleData } = this.state;\n        const clientRect = this.moduleRef.getBoundingClientRect();\n        const { height, top } = clientRect;\n        if (!moduleData.tempData || top !== moduleData.tempData.top) {\n            moduleTopChange(moduleData.moduleId, top);\n            if (moduleData.tempData.isActive === true) {\n                this.scrollIntoView();\n            }\n        }\n        if (!moduleData.tempData || height !== moduleData.tempData.height) {\n            moduleHeightChange(moduleData.moduleId, height);\n        }\n    }\n\n    scrollIntoView() {\n        _.debounce(() => {\n            const clientRect = this.moduleRef.getBoundingClientRect();\n            const { top } = clientRect;\n            const container = document.querySelector('.J_editorInstanceArea');\n\n            // 判断是否在当前屏幕内\n            const intersectionObserver = new IntersectionObserver((entries) => {\n                const ratio = entries[0].intersectionRatio;\n                if (ratio < 1 && container) {\n                    // jq动画，待优化\n                    $(container).animate(\n                        {\n                            scrollTop: top - 50,\n                        }, {\n                            easing: 'swing',\n                        },\n                    );\n                }\n                intersectionObserver.unobserve(this.moduleRef);\n\n            });\n            intersectionObserver.observe(this.moduleRef);\n        }, 0)();\n    }\n\n    render() {\n        const {\n            moduleData,\n            moduleData: {\n                tempData: {\n                    isActive,\n                },\n                moduleTypeId,\n            }\n        } = this.state;\n        const isDecorate = this.context.BASE_DATA.pageType === 0;\n\n        return (\n            <div\n                className={`J_module d-module ${isActive ? 'active' : ''}`}\n                data-module-type-id={moduleTypeId}\n                ref={ref => this.moduleRef = ref}\n            >\n                {this.state.isEmpty ? <div className=\"d-placeholder\">请配置模块数据</div> : this.props.children}\n                {isDecorate && <ModuleWrap\n                    moduleData={moduleData}\n                    moduleRef={this.moduleRef}\n                />}\n            </div>\n        );\n    }\n}\n\nconst mapStateToProps = (state: IState) => {\n    return { module: state.module };   // TODO dispatch临时丢在这里\n};\n\nconst dispatchProps = {\n    moduleTopChange,\n    moduleHeightChange,\n};\n\nconst mergeProps: any = (stateProps: any, dispatchProps: any, ownProps: any) => {\n    return Object.assign({}, stateProps, dispatchProps, ownProps);\n};\n\nexport default connect(mapStateToProps, dispatchProps, mergeProps, { withRef: true })(Module);"]}]}